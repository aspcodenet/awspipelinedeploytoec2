<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fz37I5dLqkukZAqqEcBXiiZegz6RfUqk5lRQgVKFIc16i_wyt05ZDg82Y47j6MDVmJ5_RyB2JGt_rxfp1qClyw);ol.lst-kix_list_7-0{list-style-type:none}ul.lst-kix_list_b-8{list-style-type:none}ol.lst-kix_list_9-0.start{counter-reset:lst-ctn-kix_list_9-0 0}ul.lst-kix_list_b-3{list-style-type:none}ul.lst-kix_list_b-2{list-style-type:none}ul.lst-kix_list_b-1{list-style-type:none}ul.lst-kix_list_b-7{list-style-type:none}ul.lst-kix_list_b-6{list-style-type:none}ul.lst-kix_list_b-5{list-style-type:none}ul.lst-kix_list_b-4{list-style-type:none}ul.lst-kix_list_9-3{list-style-type:none}ul.lst-kix_list_9-4{list-style-type:none}ul.lst-kix_list_9-1{list-style-type:none}ul.lst-kix_list_9-2{list-style-type:none}ul.lst-kix_list_9-7{list-style-type:none}ul.lst-kix_list_9-8{list-style-type:none}ul.lst-kix_list_9-5{list-style-type:none}.lst-kix_list_5-0>li{counter-increment:lst-ctn-kix_list_5-0}.lst-kix_list_7-0>li{counter-increment:lst-ctn-kix_list_7-0}.lst-kix_list_9-0>li{counter-increment:lst-ctn-kix_list_9-0}ul.lst-kix_list_9-6{list-style-type:none}ul.lst-kix_list_1-3{list-style-type:none}ul.lst-kix_list_1-4{list-style-type:none}ul.lst-kix_list_1-1{list-style-type:none}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_1-7{list-style-type:none}ul.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}.lst-kix_list_5-0>li:before{content:"" counter(lst-ctn-kix_list_5-0,decimal) ". "}ol.lst-kix_list_6-0{list-style-type:none}.lst-kix_list_5-3>li:before{content:"\0025a0   "}ul.lst-kix_list_a-4{list-style-type:none}ul.lst-kix_list_a-3{list-style-type:none}.lst-kix_list_5-2>li:before{content:"\0025a0   "}ul.lst-kix_list_a-2{list-style-type:none}ul.lst-kix_list_a-1{list-style-type:none}.lst-kix_list_5-1>li:before{content:"\0025cb   "}ul.lst-kix_list_a-8{list-style-type:none}ul.lst-kix_list_a-7{list-style-type:none}ul.lst-kix_list_a-6{list-style-type:none}ul.lst-kix_list_a-5{list-style-type:none}.lst-kix_list_5-7>li:before{content:"\0025a0   "}ul.lst-kix_list_8-4{list-style-type:none}ul.lst-kix_list_8-5{list-style-type:none}.lst-kix_list_5-6>li:before{content:"\0025a0   "}.lst-kix_list_5-8>li:before{content:"\0025a0   "}ul.lst-kix_list_8-2{list-style-type:none}ul.lst-kix_list_8-3{list-style-type:none}ul.lst-kix_list_8-8{list-style-type:none}ul.lst-kix_list_8-6{list-style-type:none}ul.lst-kix_list_8-7{list-style-type:none}.lst-kix_list_5-4>li:before{content:"\0025a0   "}.lst-kix_list_5-5>li:before{content:"\0025a0   "}ul.lst-kix_list_8-1{list-style-type:none}ol.lst-kix_list_1-0.start{counter-reset:lst-ctn-kix_list_1-0 0}.lst-kix_list_6-1>li:before{content:"\0025cb   "}.lst-kix_list_6-3>li:before{content:"\0025a0   "}.lst-kix_list_6-0>li:before{content:"" counter(lst-ctn-kix_list_6-0,decimal) ". "}.lst-kix_list_6-4>li:before{content:"\0025a0   "}.lst-kix_list_3-0>li{counter-increment:lst-ctn-kix_list_3-0}ol.lst-kix_list_4-0.start{counter-reset:lst-ctn-kix_list_4-0 0}.lst-kix_list_6-2>li:before{content:"\0025a0   "}.lst-kix_list_6-8>li:before{content:"\0025a0   "}.lst-kix_list_6-5>li:before{content:"\0025a0   "}.lst-kix_list_6-7>li:before{content:"\0025a0   "}.lst-kix_list_6-6>li:before{content:"\0025a0   "}.lst-kix_list_2-7>li:before{content:"\0025a0   "}.lst-kix_list_7-4>li:before{content:"\0025a0   "}.lst-kix_list_7-6>li:before{content:"\0025a0   "}ol.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_2-5>li:before{content:"\0025a0   "}.lst-kix_list_b-8>li:before{content:"\0025a0   "}.lst-kix_list_7-2>li:before{content:"\0025a0   "}.lst-kix_list_b-4>li:before{content:"\0025a0   "}ul.lst-kix_list_3-7{list-style-type:none}ul.lst-kix_list_3-8{list-style-type:none}ol.lst-kix_list_3-0.start{counter-reset:lst-ctn-kix_list_3-0 0}ul.lst-kix_list_3-1{list-style-type:none}ul.lst-kix_list_3-2{list-style-type:none}.lst-kix_list_7-8>li:before{content:"\0025a0   "}ul.lst-kix_list_3-5{list-style-type:none}ol.lst-kix_list_9-0{list-style-type:none}.lst-kix_list_b-6>li:before{content:"\0025a0   "}ul.lst-kix_list_3-6{list-style-type:none}ul.lst-kix_list_3-3{list-style-type:none}ul.lst-kix_list_3-4{list-style-type:none}.lst-kix_list_b-0>li:before{content:"" counter(lst-ctn-kix_list_b-0,decimal) ". "}.lst-kix_list_4-1>li:before{content:"\0025cb   "}.lst-kix_list_b-2>li:before{content:"\0025a0   "}.lst-kix_list_9-2>li:before{content:"\0025a0   "}.lst-kix_list_4-3>li:before{content:"\0025a0   "}.lst-kix_list_4-5>li:before{content:"\0025a0   "}ol.lst-kix_list_b-0{list-style-type:none}.lst-kix_list_9-0>li:before{content:"" counter(lst-ctn-kix_list_9-0,decimal) ". "}.lst-kix_list_9-6>li:before{content:"\0025a0   "}.lst-kix_list_9-4>li:before{content:"\0025a0   "}.lst-kix_list_a-0>li:before{content:"" counter(lst-ctn-kix_list_a-0,decimal) ". "}ul.lst-kix_list_2-8{list-style-type:none}ol.lst-kix_list_b-0.start{counter-reset:lst-ctn-kix_list_b-0 0}ul.lst-kix_list_2-2{list-style-type:none}ul.lst-kix_list_2-3{list-style-type:none}ul.lst-kix_list_2-1{list-style-type:none}ol.lst-kix_list_8-0{list-style-type:none}.lst-kix_list_9-8>li:before{content:"\0025a0   "}ul.lst-kix_list_2-6{list-style-type:none}.lst-kix_list_1-1>li:before{content:"\0025cb   "}ul.lst-kix_list_2-7{list-style-type:none}ul.lst-kix_list_2-4{list-style-type:none}ul.lst-kix_list_2-5{list-style-type:none}.lst-kix_list_b-0>li{counter-increment:lst-ctn-kix_list_b-0}.lst-kix_list_1-3>li:before{content:"\0025a0   "}.lst-kix_list_1-7>li:before{content:"\0025a0   "}.lst-kix_list_1-5>li:before{content:"\0025a0   "}ol.lst-kix_list_a-0{list-style-type:none}.lst-kix_list_2-1>li:before{content:"\0025cb   "}ol.lst-kix_list_6-0.start{counter-reset:lst-ctn-kix_list_6-0 0}.lst-kix_list_2-3>li:before{content:"\0025a0   "}ol.lst-kix_list_3-0{list-style-type:none}.lst-kix_list_3-0>li:before{content:"" counter(lst-ctn-kix_list_3-0,decimal) ". "}ul.lst-kix_list_5-7{list-style-type:none}ul.lst-kix_list_5-8{list-style-type:none}.lst-kix_list_3-1>li:before{content:"\0025cb   "}.lst-kix_list_3-2>li:before{content:"\0025a0   "}ul.lst-kix_list_5-5{list-style-type:none}ul.lst-kix_list_5-6{list-style-type:none}.lst-kix_list_8-1>li:before{content:"\0025cb   "}.lst-kix_list_4-0>li{counter-increment:lst-ctn-kix_list_4-0}.lst-kix_list_8-2>li:before{content:"\0025a0   "}.lst-kix_list_6-0>li{counter-increment:lst-ctn-kix_list_6-0}.lst-kix_list_8-0>li{counter-increment:lst-ctn-kix_list_8-0}.lst-kix_list_3-5>li:before{content:"\0025a0   "}.lst-kix_list_3-4>li:before{content:"\0025a0   "}ul.lst-kix_list_5-3{list-style-type:none}.lst-kix_list_3-3>li:before{content:"\0025a0   "}ul.lst-kix_list_5-4{list-style-type:none}ul.lst-kix_list_5-1{list-style-type:none}.lst-kix_list_8-0>li:before{content:"" counter(lst-ctn-kix_list_8-0,decimal) ". "}ul.lst-kix_list_5-2{list-style-type:none}.lst-kix_list_8-7>li:before{content:"\0025a0   "}.lst-kix_list_3-8>li:before{content:"\0025a0   "}.lst-kix_list_8-5>li:before{content:"\0025a0   "}.lst-kix_list_a-7>li:before{content:"\0025a0   "}.lst-kix_list_8-6>li:before{content:"\0025a0   "}.lst-kix_list_2-0>li{counter-increment:lst-ctn-kix_list_2-0}.lst-kix_list_8-3>li:before{content:"\0025a0   "}.lst-kix_list_3-6>li:before{content:"\0025a0   "}.lst-kix_list_3-7>li:before{content:"\0025a0   "}.lst-kix_list_a-8>li:before{content:"\0025a0   "}.lst-kix_list_8-4>li:before{content:"\0025a0   "}ol.lst-kix_list_5-0.start{counter-reset:lst-ctn-kix_list_5-0 0}.lst-kix_list_a-1>li:before{content:"\0025cb   "}.lst-kix_list_a-2>li:before{content:"\0025a0   "}.lst-kix_list_a-3>li:before{content:"\0025a0   "}.lst-kix_list_a-5>li:before{content:"\0025a0   "}.lst-kix_list_a-6>li:before{content:"\0025a0   "}.lst-kix_list_a-4>li:before{content:"\0025a0   "}.lst-kix_list_8-8>li:before{content:"\0025a0   "}ol.lst-kix_list_2-0{list-style-type:none}.lst-kix_list_4-8>li:before{content:"\0025a0   "}.lst-kix_list_4-7>li:before{content:"\0025a0   "}ul.lst-kix_list_4-8{list-style-type:none}ul.lst-kix_list_4-6{list-style-type:none}ul.lst-kix_list_4-7{list-style-type:none}ul.lst-kix_list_4-1{list-style-type:none}ul.lst-kix_list_4-4{list-style-type:none}ul.lst-kix_list_4-5{list-style-type:none}ul.lst-kix_list_4-2{list-style-type:none}ul.lst-kix_list_4-3{list-style-type:none}ol.lst-kix_list_8-0.start{counter-reset:lst-ctn-kix_list_8-0 0}.lst-kix_list_7-0>li:before{content:"" counter(lst-ctn-kix_list_7-0,decimal) ". "}ol.lst-kix_list_5-0{list-style-type:none}.lst-kix_list_2-6>li:before{content:"\0025a0   "}.lst-kix_list_2-4>li:before{content:"\0025a0   "}.lst-kix_list_2-8>li:before{content:"\0025a0   "}.lst-kix_list_7-1>li:before{content:"\0025cb   "}.lst-kix_list_7-5>li:before{content:"\0025a0   "}.lst-kix_list_7-3>li:before{content:"\0025a0   "}ul.lst-kix_list_7-5{list-style-type:none}ul.lst-kix_list_7-6{list-style-type:none}.lst-kix_list_b-5>li:before{content:"\0025a0   "}ul.lst-kix_list_7-3{list-style-type:none}ul.lst-kix_list_7-4{list-style-type:none}.lst-kix_list_b-3>li:before{content:"\0025a0   "}.lst-kix_list_b-7>li:before{content:"\0025a0   "}ul.lst-kix_list_7-7{list-style-type:none}ul.lst-kix_list_7-8{list-style-type:none}ol.lst-kix_list_a-0.start{counter-reset:lst-ctn-kix_list_a-0 0}ul.lst-kix_list_7-1{list-style-type:none}ul.lst-kix_list_7-2{list-style-type:none}.lst-kix_list_7-7>li:before{content:"\0025a0   "}.lst-kix_list_4-0>li:before{content:"" counter(lst-ctn-kix_list_4-0,decimal) ". "}.lst-kix_list_b-1>li:before{content:"\0025cb   "}.lst-kix_list_4-4>li:before{content:"\0025a0   "}.lst-kix_list_4-2>li:before{content:"\0025a0   "}.lst-kix_list_4-6>li:before{content:"\0025a0   "}.lst-kix_list_9-3>li:before{content:"\0025a0   "}ol.lst-kix_list_7-0.start{counter-reset:lst-ctn-kix_list_7-0 0}.lst-kix_list_9-1>li:before{content:"\0025cb   "}ol.lst-kix_list_4-0{list-style-type:none}.lst-kix_list_9-7>li:before{content:"\0025a0   "}.lst-kix_list_9-5>li:before{content:"\0025a0   "}ul.lst-kix_list_6-6{list-style-type:none}ul.lst-kix_list_6-7{list-style-type:none}ul.lst-kix_list_6-4{list-style-type:none}ul.lst-kix_list_6-5{list-style-type:none}ul.lst-kix_list_6-8{list-style-type:none}.lst-kix_list_1-0>li:before{content:"" counter(lst-ctn-kix_list_1-0,decimal) ". "}ul.lst-kix_list_6-2{list-style-type:none}.lst-kix_list_a-0>li{counter-increment:lst-ctn-kix_list_a-0}ul.lst-kix_list_6-3{list-style-type:none}.lst-kix_list_1-2>li:before{content:"\0025a0   "}ol.lst-kix_list_2-0.start{counter-reset:lst-ctn-kix_list_2-0 0}ul.lst-kix_list_6-1{list-style-type:none}.lst-kix_list_1-4>li:before{content:"\0025a0   "}.lst-kix_list_1-0>li{counter-increment:lst-ctn-kix_list_1-0}.lst-kix_list_1-6>li:before{content:"\0025a0   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_list_2-0>li:before{content:"" counter(lst-ctn-kix_list_2-0,decimal) ". "}.lst-kix_list_1-8>li:before{content:"\0025a0   "}.lst-kix_list_2-2>li:before{content:"\0025a0   "}ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#1b1c1d;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Google Sans Text";font-style:normal}.c12{color:#1b1c1d;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:18pt;font-family:"Google Sans";font-style:normal}.c8{color:#1b1c1d;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:24pt;font-family:"Google Sans";font-style:normal}.c14{color:#1b1c1d;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Google Sans";font-style:normal}.c6{margin-left:44.2pt;padding-top:6pt;padding-bottom:6pt;line-height:1.149999976158142;padding-left:0pt;text-align:left}.c13{margin-left:64.5pt;padding-top:6pt;padding-bottom:6pt;line-height:1.149999976158142;padding-left:0pt;text-align:left}.c9{margin-left:24pt;padding-top:6pt;padding-bottom:6pt;line-height:1.149999976158142;padding-left:0pt;text-align:left}.c4{padding-top:0pt;padding-bottom:12pt;line-height:1.149999976158142;text-align:left}.c10{text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c17{padding-top:6pt;padding-bottom:12pt;line-height:1.149999976158142;text-align:left}.c7{padding-top:0pt;padding-bottom:6pt;line-height:1.149999976158142;text-align:left}.c15{padding-top:6pt;padding-bottom:6pt;line-height:1.149999976158142;text-align:left}.c19{text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:italic}.c3{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c0{color:#1b1c1d;font-weight:700;font-family:"Google Sans Text"}.c5{color:#1b1c1d;font-weight:400;font-family:"Google Sans Text"}.c16{margin-left:44.2pt;padding-left:0pt}.c18{margin-left:64.5pt;padding-left:0pt}.c2{padding:0;margin:0}.c11{margin-left:24pt;padding-left:0pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Arial";line-height:1.0;page-break-after:avoid;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0;page-break-after:avoid;font-style:italic;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:12pt;color:#000000;font-weight:700;font-size:24pt;padding-bottom:12pt;font-family:"Arial";line-height:1.0;text-align:left}h2{padding-top:11.2pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:11.2pt;font-family:"Arial";line-height:1.0;text-align:left}h3{padding-top:12pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:12pt;font-family:"Arial";line-height:1.0;text-align:left}h4{padding-top:12.8pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:12.8pt;font-family:"Arial";line-height:1.0;text-align:left}h5{padding-top:12.8pt;color:#000000;font-weight:700;font-size:9pt;padding-bottom:12.8pt;font-family:"Arial";line-height:1.0;text-align:left}h6{padding-top:18pt;color:#000000;font-weight:700;font-size:8pt;padding-bottom:18pt;font-family:"Arial";line-height:1.0;text-align:left}</style></head><body class="c3 doc-content"><h1 class="c7"><span class="c8">Automated CI/CD for Docker on AWS</span></h1><p class="c4"><span class="c1">This guide provides a comprehensive, step-by-step walkthrough for creating a Continuous Integration and Continuous Deployment (CI/CD) pipeline on Amazon Web Services (AWS). This pipeline will automatically build a Docker image from a code change, push it to Docker Hub, and deploy the new image to an Amazon EC2 instance.</span></p><h2 class="c7"><span class="c12">Prerequisites</span></h2><p class="c7"><span class="c1">Before you begin, ensure you have the following:</span></p><ol class="c2 lst-kix_list_1-0 start" start="1"><li class="c7 c11 li-bullet-0"><span class="c0">AWS Account:</span><span class="c1">&nbsp;With administrative access to create IAM roles, CodePipeline, CodeBuild, and EC2 instances.</span></li><li class="c9 li-bullet-0"><span class="c0">Source Code Repository:</span><span class="c1">&nbsp;A repository on GitHub, AWS CodeCommit, or Bitbucket containing your application code and a Dockerfile.</span></li><li class="c9 li-bullet-0"><span class="c0">Docker Hub Account:</span><span class="c1">&nbsp;A Docker Hub account to store your images.</span></li><li class="c9 li-bullet-0"><span class="c0">Amazon EC2 Instance:</span><span class="c1">&nbsp;A running EC2 instance with Docker and the AWS CodeDeploy agent installed.</span></li></ol><h2 class="c15"><span class="c12">Step 1: Secure Docker Hub Credentials in AWS Systems Manager Parameter Store</span></h2><p class="c7"><span class="c1">Instead of using AWS Secrets Manager, we will use AWS Systems Manager Parameter Store, which is a free service for this use case. We will store your Docker Hub username and Personal Access Token (PAT) as secure string parameters.</span></p><ol class="c2 lst-kix_list_2-0 start" start="1"><li class="c7 c11 li-bullet-0"><span class="c5">Navigate to the </span><span class="c0">AWS Systems Manager</span><span class="c5">&nbsp;console and click on </span><span class="c0">Parameter Store</span><span class="c1">.</span></li><li class="c9 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Create parameter&quot;</span><span class="c1">.</span></li><li class="c9 li-bullet-0"><span class="c1">Create the first parameter for your username:</span></li></ol><ul class="c2 lst-kix_list_3-1 start"><li class="c7 c16 li-bullet-0"><span class="c0">Name:</span><span class="c1">&nbsp;Give it a descriptive name, like /docker/username.</span></li><li class="c6 li-bullet-0"><span class="c0">Description:</span><span class="c1">&nbsp;Add a brief description, e.g., Docker Hub Username.</span></li><li class="c6 li-bullet-0"><span class="c0">Tier:</span><span class="c5">&nbsp;Choose </span><span class="c0">Standard</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">Type:</span><span class="c5">&nbsp;Choose </span><span class="c0">SecureString</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">KMS key source:</span><span class="c1">&nbsp;Use My current account and alias/aws/ssm.</span></li><li class="c6 li-bullet-0"><span class="c0">Value:</span><span class="c1">&nbsp;Enter your Docker Hub username.</span></li><li class="c6 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Create parameter&quot;</span><span class="c1">.</span></li></ul><ol class="c2 lst-kix_list_2-0" start="4"><li class="c9 li-bullet-0"><span class="c1">Repeat the process for your Personal Access Token (PAT):</span></li></ol><ul class="c2 lst-kix_list_4-1 start"><li class="c7 c16 li-bullet-0"><span class="c0">Name:</span><span class="c1">&nbsp;Give it a descriptive name, like /docker/password.</span></li><li class="c6 li-bullet-0"><span class="c0">Description:</span><span class="c1">&nbsp;Add a brief description, e.g., Docker Hub PAT.</span></li><li class="c6 li-bullet-0"><span class="c0">Tier:</span><span class="c5">&nbsp;Choose </span><span class="c0">Standard</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">Type:</span><span class="c5">&nbsp;Choose </span><span class="c0">SecureString</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">KMS key source:</span><span class="c1">&nbsp;Use My current account and alias/aws/ssm.</span></li><li class="c6 li-bullet-0"><span class="c0">Value:</span><span class="c1">&nbsp;Enter your Docker Hub PAT.</span></li><li class="c6 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Create parameter&quot;</span><span class="c1">.</span></li></ul><h2 class="c15"><span class="c12">Step 2: Create the Build Configuration (buildspec.yml)</span></h2><p class="c4"><span class="c1">The buildspec.yml file is the instruction set for AWS CodeBuild. It tells CodeBuild what to do at each phase of the build. Place this file in the root of your source code repository.</span></p><p class="c4"><span class="c1">This file will retrieve the credentials from Parameter Store, log in to Docker Hub, build the image, tag it, and push it.</span></p><p class="c4"><span class="c0 c10">buildspec.yml</span></p><p class="c4"><span class="c1">version: 0.2<br><br># Define environment variables<br>env:<br> &nbsp;variables:<br> &nbsp; &nbsp;DOCKER_IMAGE_NAME: &quot;your-dockerhub-username/your-repo-name&quot;<br> &nbsp; &nbsp;DOCKER_TAG: &quot;latest&quot;<br> &nbsp; &nbsp;# The names of the parameters created in Step 1<br> &nbsp; &nbsp;USERNAME_PARAM_NAME: &quot;/docker/username&quot; <br> &nbsp; &nbsp;PASSWORD_PARAM_NAME: &quot;/docker/password&quot;<br> &nbsp; &nbsp;REGION: &quot;your-aws-region&quot; # e.g., us-east-1<br><br>phases:<br> &nbsp;pre_build:<br> &nbsp; &nbsp;commands:<br> &nbsp; &nbsp; &nbsp;- echo &quot;Retrieving Docker Hub credentials from Parameter Store...&quot;<br> &nbsp; &nbsp; &nbsp;# Use the AWS CLI to retrieve the secure string parameters<br> &nbsp; &nbsp; &nbsp;- DOCKER_HUB_USERNAME=$(aws ssm get-parameter --name &quot;$USERNAME_PARAM_NAME&quot; --with-decryption --query &quot;Parameter.Value&quot; --output text --region $REGION)<br> &nbsp; &nbsp; &nbsp;- DOCKER_HUB_PASSWORD=$(aws ssm get-parameter --name &quot;$PASSWORD_PARAM_NAME&quot; --with-decryption --query &quot;Parameter.Value&quot; --output text --region $REGION)<br> &nbsp; &nbsp; &nbsp;- echo &quot;Logging in to Docker Hub...&quot;<br> &nbsp; &nbsp; &nbsp;# Use the retrieved credentials to log in<br> &nbsp; &nbsp; &nbsp;- docker login -u &quot;$DOCKER_HUB_USERNAME&quot; -p &quot;$DOCKER_HUB_PASSWORD&quot;<br> &nbsp;build:<br> &nbsp; &nbsp;commands:<br> &nbsp; &nbsp; &nbsp;- echo &quot;Building the Docker image...&quot;<br> &nbsp; &nbsp; &nbsp;# Build the Docker image from the Dockerfile in the current directory<br> &nbsp; &nbsp; &nbsp;- docker build -t $DOCKER_IMAGE_NAME .<br> &nbsp;post_build:<br> &nbsp; &nbsp;commands:<br> &nbsp; &nbsp; &nbsp;- echo &quot;Tagging and pushing the Docker image...&quot;<br> &nbsp; &nbsp; &nbsp;# Tag the image with the latest tag<br> &nbsp; &nbsp; &nbsp;- docker tag $DOCKER_IMAGE_NAME:latest $DOCKER_IMAGE_NAME:$DOCKER_TAG<br> &nbsp; &nbsp; &nbsp;- docker push $DOCKER_IMAGE_NAME:$DOCKER_TAG<br> &nbsp; &nbsp; &nbsp;- echo &quot;Push complete. Generating image manifest file...&quot;<br> &nbsp; &nbsp; &nbsp;# Create an artifact file for CodeDeploy<br> &nbsp; &nbsp; &nbsp;- printf &#39;{&quot;ImageUri&quot;:&quot;%s&quot;}&#39; &quot;$DOCKER_IMAGE_NAME:$DOCKER_TAG&quot; &gt; image.json<br>artifacts:<br> &nbsp;files:<br> &nbsp; &nbsp;- image.json<br> &nbsp; &nbsp;- appspec.yml<br> &nbsp; &nbsp;- scripts/deploy.sh<br></span></p><p class="c4"><span class="c0">Note:</span><span class="c1">&nbsp;The --with-decryption flag is essential for retrieving the value of a SecureString parameter.</span></p><h2 class="c7"><span class="c12">Step 3: Configure AWS CodeDeploy on Your EC2 Instance</span></h2><p class="c4"><span class="c1">To automatically update the EC2 instance, you need to use AWS CodeDeploy. This involves installing the CodeDeploy agent and providing a deployment specification file (appspec.yml).</span></p><h3 class="c7"><span class="c14">a. Install CodeDeploy Agent</span></h3><p class="c4"><span class="c1">On your EC2 instance, run the following commands (for Amazon Linux 2):</span></p><p class="c4"><span class="c1">#!/bin/bash<br>sudo yum update -y<br>sudo yum install ruby -y<br>sudo yum install wget -y<br>cd /home/ec2-user<br>wget [https://aws-codedeploy-us-east-1.s3.us-east-1.amazonaws.com/latest/install](https://aws-codedeploy-us-east-1.s3.us-east-1.amazonaws.com/latest/install)<br>chmod +x ./install<br>sudo ./install auto<br>sudo service codedeploy-agent status<br><br></span></p><p class="c4"><span class="c5 c19">Note: Replace us-east-1 with your AWS region.</span></p><h3 class="c7"><span class="c14">b. Create the Deployment Scripts</span></h3><p class="c4"><span class="c1">CodeDeploy uses lifecycle hooks to run scripts at specific stages. Create a folder named scripts in your repository and a file inside it called deploy.sh. This script will pull the new image and restart the container.</span></p><p class="c4"><span class="c10 c0">scripts/deploy.sh</span></p><p class="c4"><span class="c1">#!/bin/bash<br>IMAGE_URI=&quot;your-dockerhub-username/your-repo-name:latest&quot; # Change to your image name<br><br># Stop and remove the old container if it exists<br>if [ $(docker ps -a -q -f name=my-app-container) ]; then<br> &nbsp;docker stop my-app-container<br> &nbsp;docker rm my-app-container<br>fi<br><br># Pull the new Docker image<br>docker pull $IMAGE_URI<br><br># Run the new container, mapping the ports<br>docker run -d --name my-app-container -p 80:8000 $IMAGE_URI<br><br></span></p><h3 class="c7"><span class="c14">c. Create the Application Specification File (appspec.yml)</span></h3><p class="c4"><span class="c1">The appspec.yml file tells CodeDeploy which files to copy and which scripts to run. Place this file in the root of your repository.</span></p><p class="c4"><span class="c10 c0">appspec.yml</span></p><p class="c4"><span class="c1">version: 0.0<br>os: linux<br>files:<br> &nbsp;- source: /<br> &nbsp; &nbsp;destination: /home/ec2-user/myapp<br>hooks:<br> &nbsp;AfterInstall:<br> &nbsp; &nbsp;- location: scripts/deploy.sh<br> &nbsp; &nbsp; &nbsp;timeout: 300<br> &nbsp; &nbsp; &nbsp;runas: ec2-user<br><br></span></p><p class="c4"><span class="c1">The AfterInstall hook ensures that the deploy.sh script runs after the new files (in this case, our build artifacts) have been copied to the EC2 instance.</span></p><h2 class="c7"><span class="c12">Step 4: Configure the AWS CodePipeline</span></h2><p class="c7"><span class="c1">Now, we will tie all the pieces together into a fully automated pipeline.</span></p><ol class="c2 lst-kix_list_5-0 start" start="1"><li class="c7 c11 li-bullet-0"><span class="c5">Navigate to the </span><span class="c0">AWS CodePipeline</span><span class="c1">&nbsp;console.</span></li><li class="c9 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Create pipeline&quot;</span><span class="c1">.</span></li><li class="c9 li-bullet-0"><span class="c0">Step 1: Choose pipeline settings.</span><span class="c1">&nbsp;Give your pipeline a name. Choose a new service role for CodePipeline, and leave all other defaults.</span></li><li class="c9 li-bullet-0"><span class="c10 c0">Step 2: Add source stage.</span></li></ol><ul class="c2 lst-kix_list_6-1 start"><li class="c7 c16 li-bullet-0"><span class="c0">Source provider:</span><span class="c1">&nbsp;Choose your source (e.g., GitHub).</span></li><li class="c6 li-bullet-0"><span class="c0">Connect:</span><span class="c1">&nbsp;Connect to your repository.</span></li><li class="c6 li-bullet-0"><span class="c0">Repository name:</span><span class="c1">&nbsp;Select your repository.</span></li><li class="c6 li-bullet-0"><span class="c0">Branch name:</span><span class="c1">&nbsp;Select the branch to monitor for changes (e.g., main).</span></li><li class="c6 li-bullet-0"><span class="c0">Change detection:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;AWS CodePipeline&quot;</span><span class="c1">.</span></li></ul><ol class="c2 lst-kix_list_5-0" start="5"><li class="c9 li-bullet-0"><span class="c10 c0">Step 3: Add build stage.</span></li></ol><ul class="c2 lst-kix_list_7-1 start"><li class="c7 c16 li-bullet-0"><span class="c0">Build provider:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;AWS CodeBuild&quot;</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">Region:</span><span class="c1">&nbsp;Select your region.</span></li><li class="c6 li-bullet-0"><span class="c0">Project name:</span><span class="c5">&nbsp;Click </span><span class="c0">&quot;Create project&quot;</span><span class="c1">.</span></li></ul><ul class="c2 lst-kix_list_8-2 start"><li class="c7 c18 li-bullet-0"><span class="c0">Project name:</span><span class="c1">&nbsp;Give it a name (e.g., docker-pipeline-build).</span></li><li class="c13 li-bullet-0"><span class="c0">Environment:</span><span class="c5">&nbsp;Choose a managed image, select </span><span class="c0">&quot;Ubuntu&quot;</span><span class="c5">, and check </span><span class="c0">&quot;Privileged&quot;</span><span class="c1">. This is essential for building Docker images.</span></li><li class="c13 li-bullet-0"><span class="c0">Service role:</span><span class="c1">&nbsp;Create a new service role. This role will need permissions to access Parameter Store. Ensure you add a policy that allows ssm:GetParameter and kms:Decrypt actions on your specific parameter ARNs.</span></li><li class="c13 li-bullet-0"><span class="c0">Buildspec:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;Use a buildspec file&quot;</span><span class="c1">&nbsp;and ensure the path is buildspec.yml.</span></li><li class="c13 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Continue to CodePipeline&quot;</span><span class="c1">.</span></li></ul><ol class="c2 lst-kix_list_5-0" start="6"><li class="c9 li-bullet-0"><span class="c10 c0">Step 4: Add deploy stage.</span></li></ol><ul class="c2 lst-kix_list_9-1 start"><li class="c7 c16 li-bullet-0"><span class="c0">Deploy provider:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;AWS CodeDeploy&quot;</span><span class="c1">.</span></li><li class="c6 li-bullet-0"><span class="c0">Application name:</span><span class="c1">&nbsp;Create a new application (e.g., MyWebApp).</span></li><li class="c6 li-bullet-0"><span class="c0">Deployment group:</span><span class="c1">&nbsp;Create a new group.</span></li></ul><ul class="c2 lst-kix_list_a-2 start"><li class="c7 c18 li-bullet-0"><span class="c0">Deployment group name:</span><span class="c1">&nbsp;Give it a name (e.g., Production).</span></li><li class="c13 li-bullet-0"><span class="c0">Environment configuration:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;In-place&quot;</span><span class="c5">&nbsp;and select </span><span class="c0">&quot;Amazon EC2 instances&quot;</span><span class="c1">.</span></li><li class="c13 li-bullet-0"><span class="c0">Install CodeDeploy Agent:</span><span class="c5">&nbsp;Choose </span><span class="c0">&quot;Never&quot;</span><span class="c1">&nbsp;since we already did this manually.</span></li><li class="c13 li-bullet-0"><span class="c0">EC2 Instance Tags:</span><span class="c1">&nbsp;Use tags to identify your EC2 instance (e.g., Key: Name, Value: MyWebAppInstance).</span></li><li class="c13 li-bullet-0"><span class="c0">Service role:</span><span class="c1">&nbsp;Create a new service role for CodeDeploy. This role needs permissions to the EC2 instance.</span></li></ul><ul class="c2 lst-kix_list_9-1"><li class="c6 li-bullet-0"><span class="c5">Click </span><span class="c0">&quot;Create deployment group&quot;</span><span class="c1">.</span></li></ul><ol class="c2 lst-kix_list_5-0" start="7"><li class="c9 li-bullet-0"><span class="c0">Review and create.</span><span class="c5">&nbsp;Review your pipeline settings and click </span><span class="c0">&quot;Create pipeline&quot;</span><span class="c1">.</span></li></ol><p class="c15"><span class="c1">The pipeline will start running automatically. On the first run, it will:</span></p><ol class="c2 lst-kix_list_b-0 start" start="1"><li class="c7 c11 li-bullet-0"><span class="c0">Source:</span><span class="c1">&nbsp;Pull your code from the repository.</span></li><li class="c9 li-bullet-0"><span class="c0">Build:</span><span class="c1">&nbsp;Run the buildspec.yml to build and push the Docker image to Docker Hub, and create the artifact files.</span></li><li class="c9 li-bullet-0"><span class="c0">Deploy:</span><span class="c1">&nbsp;Trigger CodeDeploy to update the EC2 instance, which in turn runs the deploy.sh script to pull and run the new container.</span></li></ol><p class="c17"><span class="c1">Subsequent commits to your source repository will trigger this entire process automatically.</span></p></body></html>
