<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AWS CodePipeline Guide for Docker on EC2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: DevOps Calm -->
    <!-- Application Structure Plan: A single-page application with a sticky top navigation bar for quick access to different sections. The structure is designed to be sequential, guiding the user from an overview and prerequisites to the core configuration files and a final visual summary of the pipeline stages. The configuration files are presented in an interactive tabbed interface to prevent a long scroll and group related code snippets. The pipeline stages are shown as an interactive flowchart. This structure was chosen because the source material is a step-by-step technical guide, and this design enhances clarity and allows users to easily reference different components without losing context. -->
    <!-- Visualization & Content Choices: The core of this application is transforming the linear text document into an interactive experience. Prerequisites are a checklist for engagement. Configuration files are in tabs (HTML/JS) for organization. The key visualization is a pipeline flowchart (HTML/CSS) to explain relationships between stages. Clicking a stage provides details, making it an interactive diagram. This is more effective for understanding a process than a static list. All code is presented in formatted blocks with copy functionality for utility. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .tab-btn.active {
            border-color: #3b82f6;
            background-color: #eff6ff;
            color: #1e40af;
        }
        .code-block {
            background-color: #1f2937;
            color: #d1d5db;
        }
        .pipeline-stage.active {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-white/80 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center max-w-6xl">
            <h1 class="text-xl md:text-2xl font-bold text-gray-900">AWS CodePipeline Guide</h1>
            <div class="hidden md:flex space-x-6">
                <a href="#overview" class="text-gray-600 hover:text-blue-600 transition-colors">Overview</a>
                <a href="#prerequisites" class="text-gray-600 hover:text-blue-600 transition-colors">Prerequisites</a>
                <a href="#config" class="text-gray-600 hover:text-blue-600 transition-colors">Config Files</a>
                <a href="#stages" class="text-gray-600 hover:text-blue-600 transition-colors">Pipeline Stages</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12 max-w-6xl">
        
        <section id="overview" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b pb-2">Pipeline Overview</h2>
            <p class="text-lg text-gray-700">
                This guide provides an interactive walkthrough for setting up an AWS CodePipeline to automatically build a Docker image from your source code and deploy it to an EC2 instance. The process is broken down into three main stages: Source, Build, and Deploy. This application will guide you through the necessary files and concepts to create a robust CI/CD workflow.
            </p>
        </section>

        <section id="prerequisites" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b pb-2">Prerequisites Checklist</h2>
            <p class="text-gray-700 mb-6">Before you begin, ensure you have the following AWS resources and configurations in place. Check them off as you go.</p>
            <div class="space-y-4">
                <label class="flex items-center p-4 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-blue-50 transition-all">
                    <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-4 text-gray-800 font-medium">An EC2 Instance with the CodeDeploy agent installed and a suitable IAM role attached. (<a href="ec2setup.html">Instructions</a>)</span>
                </label>
                <label class="flex items-center p-4 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-blue-50 transition-all">
                    <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-4 text-gray-800 font-medium">An ECR Repository to store your Docker images.</span>
                </label>
                <label class="flex items-center p-4 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-blue-50 transition-all">
                    <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-4 text-gray-800 font-medium">A GitHub or CodeCommit Repository for your application code.</span>
                </label>
                <label class="flex items-center p-4 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-blue-50 transition-all">
                    <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="ml-4 text-gray-800 font-medium">Appropriate IAM Roles for CodePipeline, CodeBuild, and CodeDeploy.</span>
                </label>
            </div>
        </section>

        <section id="config" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b pb-2">Configuration Files</h2>
            <p class="text-gray-700 mb-6">This section contains the core configuration files that define the build and deployment process. Click each tab to view the file and understand its role in the pipeline.</p>
            
            <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="border-b border-gray-200">
                    <div id="tabs" class="flex flex-wrap -mb-px px-4">
                        <button class="tab-btn active text-lg font-medium py-4 px-5 border-b-2" data-target="dockerfile">Dockerfile</button>
                        <button class="tab-btn text-lg font-medium py-4 px-5 border-b-2 border-transparent" data-target="buildspec">buildspec.yml</button>
                        <button class="tab-btn text-lg font-medium py-4 px-5 border-b-2 border-transparent" data-target="appspec">appspec.yml</button>
                        <button class="tab-btn text-lg font-medium py-4 px-5 border-b-2 border-transparent" data-target="deploy">deploy.sh</button>
                    </div>
                </div>

                <div id="tab-content" class="p-6">
                    <div class="tab-pane active" id="dockerfile">
                        <h3 class="text-2xl font-semibold mb-2">Dockerfile</h3>
                        <p class="text-gray-600 mb-4">This file defines the steps to create a Docker image for the application. It specifies the base image, sets up the working directory, installs dependencies, and defines the command to run the application.</p>
                        <div class="code-block rounded-lg overflow-hidden relative">
                            <button class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold py-1 px-2 rounded" onclick="copyCode(this)">Copy</button>
                            <pre class="p-4 text-sm overflow-x-auto"><code class="language-dockerfile"># Use an official Node.js runtime as a parent image
FROM node:18-alpine

# Set the working directory in the container
WORKDIR /app

# Copy package.json and package-lock.json to the container
COPY package*.json ./

# Install application dependencies
RUN npm install

# Copy the rest of the application source code
COPY . .

# Expose the port the app runs on
EXPOSE 3000

# Run the application
CMD [ "npm", "start" ]</code></pre>
                        </div>
                    </div>
                    <div class="tab-pane hidden" id="buildspec">
                        <h3 class="text-2xl font-semibold mb-2">buildspec.yml</h3>
                        <p class="text-gray-600 mb-4">This file is used by AWS CodeBuild. It outlines the commands to run during the build phase, including logging into ECR, building and tagging the Docker image, pushing it to the ECR repository, and generating the `appspec.yml` file for the deployment stage.</p>
                         <div class="code-block rounded-lg overflow-hidden relative">
                            <button class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold py-1 px-2 rounded" onclick="copyCode(this)">Copy</button>
                            <pre class="p-4 text-sm overflow-x-auto"><code class="language-yaml">version: 0.2

phases:
  pre_build:
    commands:
      - echo "Logging in to Amazon ECR..."
      - aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $ECR_REPO_URL
  build:
    commands:
      - echo "Building the Docker image..."
      - docker build -t $IMAGE_REPO_NAME:$CODEBUILD_RESOLVED_SOURCE_VERSION .
      - docker tag $IMAGE_REPO_NAME:$CODEBUILD_RESOLVED_SOURCE_VERSION $ECR_REPO_URL/$IMAGE_REPO_NAME:$CODEBUILD_RESOLVED_SOURCE_VERSION
  post_build:
    commands:
      - echo "Pushing the Docker image to ECR..."
      - docker push $ECR_REPO_URL/$IMAGE_REPO_NAME:$CODEBUILD_RESOLVED_SOURCE_VERSION
      - echo "Creating the appspec.yml file..."
      - |
        cat &lt;&lt;EOF &gt; appspec.yml
        version: 0.0
        os: linux
        files:
          - source: .
            destination: /tmp/codedeploy-docker
        hooks:
          BeforeInstall:
            - location: scripts/deploy.sh
              timeout: 300
              runas: root
        EOF
      - echo "Build completed on \`date\`"

artifacts:
  files:
    - appspec.yml
    - scripts/**/*</code></pre>
                        </div>
                    </div>
                    <div class="tab-pane hidden" id="appspec">
                        <h3 class="text-2xl font-semibold mb-2">appspec.yml</h3>
                        <p class="text-gray-600 mb-4">This file is used by AWS CodeDeploy to manage a deployment. It specifies where to copy the source files on the EC2 instance and which scripts to run at different lifecycle event hooks. In this pipeline, it's generated dynamically by the build stage.</p>
                        <div class="code-block rounded-lg overflow-hidden relative">
                            <button class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold py-1 px-2 rounded" onclick="copyCode(this)">Copy</button>
                            <pre class="p-4 text-sm overflow-x-auto"><code class="language-yaml">version: 0.0
os: linux
files:
  - source: .
    destination: /tmp/codedeploy-docker
hooks:
  BeforeInstall:
    - location: scripts/deploy.sh
      timeout: 300
      runas: root</code></pre>
                        </div>
                    </div>
                    <div class="tab-pane hidden" id="deploy">
                        <h3 class="text-2xl font-semibold mb-2">scripts/deploy.sh</h3>
                        <p class="text-gray-600 mb-4">This script is executed on the target EC2 instance during the deployment. It's responsible for pulling the latest Docker image from ECR, stopping any existing container, and running the new container.</p>
                        <div class="code-block rounded-lg overflow-hidden relative">
                            <button class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold py-1 px-2 rounded" onclick="copyCode(this)">Copy</button>
                            <pre class="p-4 text-sm overflow-x-auto"><code class="language-bash">#!/bin/bash
IMAGE_NAME="your-image-repo-name"
IMAGE_TAG="your-image-tag" # This can be dynamically passed
CONTAINER_NAME="your-container-name"

# Login to ECR
aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin "your-account-id.dkr.ecr.us-east-1.amazonaws.com"

# Stop and remove the existing container
if [ $(docker ps -q -f name=$CONTAINER_NAME) ]; then
  docker stop $CONTAINER_NAME
  docker rm $CONTAINER_NAME
fi

# Pull the latest image
docker pull "your-account-id.dkr.ecr.us-east-1.amazonaws.com/$IMAGE_NAME:$IMAGE_TAG"

# Run the new container
docker run -d --name $CONTAINER_NAME -p 80:3000 "your-account-id.dkr.ecr.us-east-1.amazonaws.com/$IMAGE_NAME:$IMAGE_TAG"</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="stages" class="scroll-mt-20">
            <h2 class="text-3xl font-bold mb-4 text-gray-900 border-b pb-2">Pipeline Stages Visualized</h2>
            <p class="text-gray-700 mb-8">The following diagram illustrates the three main stages of the CodePipeline. Click on each stage to see how the configuration files are used to automate the workflow from source code to a running application.</p>
            
            <div class="flex flex-col md:flex-row items-center justify-between space-y-8 md:space-y-0 md:space-x-8">
                
                <div class="pipeline-stage-card w-full" data-stage="source">
                    <div class="pipeline-stage active bg-white p-6 rounded-xl shadow-lg border border-gray-200 cursor-pointer transition-all duration-300">
                        <h3 class="text-2xl font-bold text-blue-800">1. Source Stage</h3>
                    </div>
                    <div class="stage-details mt-4 p-5 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="font-semibold text-blue-900">CodePipeline connects to your source repository (e.g., GitHub, CodeCommit).</p>
                        <p class="mt-2 text-blue-800">It pulls the latest source code, which includes the <code class="bg-blue-200 px-1 rounded text-sm">Dockerfile</code>, <code class="bg-blue-200 px-1 rounded text-sm">buildspec.yml</code>, and the <code class="bg-blue-200 px-1 rounded text-sm">scripts/</code> directory.</p>
                    </div>
                </div>
                
                <div class="text-gray-400 text-4xl font-light transform md:-rotate-0 rotate-90">&rarr;</div>

                <div class="pipeline-stage-card w-full" data-stage="build">
                    <div class="pipeline-stage bg-white p-6 rounded-xl shadow-lg border border-gray-200 cursor-pointer transition-all duration-300">
                        <h3 class="text-2xl font-bold text-blue-800">2. Build Stage</h3>
                    </div>
                    <div class="stage-details hidden mt-4 p-5 bg-blue-50 rounded-lg border border-blue-200">
                         <p class="font-semibold text-blue-900">AWS CodeBuild is triggered and uses the <code class="bg-blue-200 px-1 rounded text-sm">buildspec.yml</code>.</p>
                         <ul class="list-disc list-inside mt-2 text-blue-800 space-y-1">
                            <li>Builds the Docker image via the <code class="bg-blue-200 px-1 rounded text-sm">Dockerfile</code>.</li>
                            <li>Pushes the image to the ECR repository.</li>
                            <li>Generates the <code class="bg-blue-200 px-1 rounded text-sm">appspec.yml</code> as a build artifact.</li>
                         </ul>
                    </div>
                </div>
                
                <div class="text-gray-400 text-4xl font-light transform md:-rotate-0 rotate-90">&rarr;</div>

                <div class="pipeline-stage-card w-full" data-stage="deploy">
                    <div class="pipeline-stage bg-white p-6 rounded-xl shadow-lg border border-gray-200 cursor-pointer transition-all duration-300">
                         <h3 class="text-2xl font-bold text-blue-800">3. Deploy Stage</h3>
                    </div>
                    <div class="stage-details hidden mt-4 p-5 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="font-semibold text-blue-900">AWS CodeDeploy is triggered using the <code class="bg-blue-200 px-1 rounded text-sm">appspec.yml</code> artifact.</p>
                        <p class="mt-2 text-blue-800">The <code class="bg-blue-200 px-1 rounded text-sm">deploy.sh</code> script is executed on the EC2 instance, which pulls the new image from ECR and runs the Docker container.</p>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-target');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    tabPanes.forEach(pane => {
                        if (pane.id === target) {
                            pane.classList.remove('hidden');
                            pane.classList.add('active');
                        } else {
                            pane.classList.add('hidden');
                            pane.classList.remove('active');
                        }
                    });
                });
            });
            
            const stages = document.querySelectorAll('.pipeline-stage');
            const stageCards = document.querySelectorAll('.pipeline-stage-card');
            
            stageCards.forEach(card => {
                card.querySelector('.pipeline-stage').addEventListener('click', () => {
                    const clickedStage = card.getAttribute('data-stage');
                    
                    stageCards.forEach(c => {
                       const stageDiv = c.querySelector('.pipeline-stage');
                       const detailsDiv = c.querySelector('.stage-details');
                       
                       if(c.getAttribute('data-stage') === clickedStage) {
                           stageDiv.classList.add('active');
                           detailsDiv.classList.remove('hidden');
                       } else {
                           stageDiv.classList.remove('active');
                           detailsDiv.classList.add('hidden');
                       }
                    });
                });
            });
        });

        function copyCode(button) {
            const codeBlock = button.nextElementSibling.querySelector('code');
            const text = codeBlock.innerText;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
    </script>
</body>
</html>
